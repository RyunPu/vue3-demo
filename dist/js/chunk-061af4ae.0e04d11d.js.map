{"version":3,"sources":["webpack:///./src/views/Images.vue?26f7","webpack:///./src/views/Images.vue","webpack:///./src/components/Image.vue","webpack:///./src/components/Image.vue?686c","webpack:///./src/composables/useEvent.js","webpack:///./src/composables/useScroll.js","webpack:///./src/composables/useEndOfPage.js","webpack:///./src/views/Images.vue?e080","webpack:///./src/utils/index.js","webpack:///./src/components/Image.vue?b585"],"names":["class","allPhotos","photo","i","key","src","webformatURL","loading","page","getPhotos","name","appear","$attrs","props","type","String","required","inheritAttrs","render","__scopeId","useEvent","el","ref","document","handler","unref","remove","removeEventListener","onMounted","addEventListener","onUnmounted","useScroll","eventEl","scrollEl","value","window","documentElement","scrollY","scrollX","throttle","scrollTop","scrollLeft","useEndOfPage","cb","margin","watch","newY","oldY","isBottom","scrollHeight","innerHeight","immediate","components","Spinner","Image","setup","perpage","usePromise","fetch","response","json","result","use","photos","hits","length","next","storage","setItem","localStorage","JSON","stringify","getItem","defaultValue","originalValue","parse","e","removeItem","fn","timer","threshold","last","Date","context","this","args","arguments","now","clearTimeout","setTimeout","apply"],"mappings":"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","file":"js/chunk-061af4ae.0e04d11d.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Images.vue?vue&type=style&index=0&id=41fc86cc&scoped=true&lang=css\"","<template>\n  <section class=\"todoapp\">\n    <header class=\"header\">\n      <h1>Images</h1>\n    </header>\n  </section>\n  <section>\n    <div class=\"article-grid\">\n      <article class=\"article\" v-for=\"(photo, i) in allPhotos\" :key=\"i\">\n        <Image :src=\"photo.webformatURL\" />\n      </article>\n    </div>\n  </section>\n\n  <div class=\"loading-box text-center p-4\">\n    <template v-if=\"loading\">\n      <Spinner />\n    </template>\n    <button v-else-if=\"page < 11\" @click=\"getPhotos\">\n      Load more Images\n    </button>\n  </div>\n</template>\n\n<script>\nimport { ref, watch } from 'vue'\nimport Spinner from '@/components/Spinner'\nimport Image from '@/components/Image'\nimport useEndOfPage from '@/composables/useEndOfPage'\nimport usePromise from '@/composables/usePromise'\n\nexport default {\n  components: {\n    Spinner,\n    Image\n  },\n  setup() {\n    const page = ref(1)\n    const allPhotos = ref([])\n    const perpage = 10\n\n    const { loading, result, use: getPhotos } = usePromise(async () => {\n      const response = await fetch(\n        `https://pixabay.com/api/?key=14551560-202ad086904416c08de2a423c&q=draw&page=${page.value}&per_page=${perpage}`\n      )\n      return response.json()\n    })\n\n    watch(result, result => {\n      if (result) {\n        const photos = result.hits\n        if (photos.length) page.value += 1\n        allPhotos.value = [...allPhotos.value, ...photos]\n      }\n    })\n\n    const next = () => {\n      if (!loading.value && page.value < 11) {\n        getPhotos()\n      }\n    }\n\n    useEndOfPage(next)\n\n    return {\n      allPhotos,\n      loading,\n      page,\n      getPhotos\n    }\n  }\n}\n</script>\n\n<style scoped>\n.article-grid {\n  column-count: 3;\n  column-gap: 10px;\n  column-fill: auto;\n}\n\n.article-grid article {\n  margin-bottom: 10px;\n}\n</style>\n","<template>\n  <transition name=\"fade\" appear>\n    <img :src=\"src\" v-bind=\"$attrs\" />\n  </transition>\n</template>\n\n<script>\nexport default {\n  props: {\n    src: {\n      type: String,\n      required: true\n    }\n  },\n  inheritAttrs: false\n}\n</script>\n\n<style scoped>\n.fade-enter-active,\n.fade-leave-active {\n  transition: opacity 0.8s;\n}\n\n.fade-enter-from,\n.fade-leave-to {\n  opacity: 0;\n}\n</style>\n","import { render } from \"./Image.vue?vue&type=template&id=00d82a28&scoped=true\"\nimport script from \"./Image.vue?vue&type=script&lang=js\"\nexport * from \"./Image.vue?vue&type=script&lang=js\"\n\nimport \"./Image.vue?vue&type=style&index=0&id=00d82a28&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-00d82a28\"\n\nexport default script","import { onMounted, onUnmounted, ref, unref } from 'vue'\n\nexport default function useEvent(el = ref(document), name, handler) {\n  el = unref(el)\n  const remove = () => el && el.removeEventListener(name, handler)\n\n  onMounted(() => el && el.addEventListener(name, handler))\n  onUnmounted(remove)\n\n  return remove\n}\n","import { throttle } from '@/utils'\nimport { ref } from 'vue'\nimport useEvent from './useEvent'\n\nexport default function useScroll(el) {\n  let eventEl\n  let scrollEl\n\n  if (el) {\n    eventEl = el\n    scrollEl = el.value\n  } else {\n    eventEl = ref(window)\n    scrollEl = document.documentElement\n  }\n\n  const scrollY = ref(null)\n  const scrollX = ref(null)\n\n  const handler = throttle(() => {\n    scrollY.value = scrollEl.scrollTop\n    scrollX.value = scrollEl.scrollLeft\n  }, 300)\n\n  const remove = useEvent(eventEl, 'scroll', handler)\n\n  return {\n    scrollX,\n    scrollY,\n    remove\n  }\n}\n","import useScroll from './useScroll'\nimport { watch } from 'vue'\n\nexport default function useEndOfPage(cb = () => {}, margin = 100) {\n  const { scrollY } = useScroll()\n\n  watch(\n    scrollY,\n    (newY, oldY) => {\n      // return if already loading or scrolling up\n      if (newY < oldY) return\n\n      const isBottom =\n        document.documentElement.scrollHeight - (window.innerHeight + newY) <\n        margin\n      // if we reached the bottom of the page ...\n      // select the next page\n      isBottom && cb()\n    },\n    {\n      immediate: true\n    }\n  )\n}\n","import { render } from \"./Images.vue?vue&type=template&id=41fc86cc&scoped=true\"\nimport script from \"./Images.vue?vue&type=script&lang=js\"\nexport * from \"./Images.vue?vue&type=script&lang=js\"\n\nimport \"./Images.vue?vue&type=style&index=0&id=41fc86cc&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-41fc86cc\"\n\nexport default script","export const storage = {\n  setItem(name, value) {\n    window.localStorage.setItem(name, JSON.stringify(value))\n  },\n\n  getItem(name, defaultValue = null) {\n    const originalValue = window.localStorage.getItem(name)\n    const value = originalValue === null ? defaultValue : originalValue\n\n    try {\n      return JSON.parse(value)\n    } catch (e) {\n      return value\n    }\n  },\n\n  removeItem(name) {\n    window.localStorage.removeItem(name)\n  }\n}\n\n/**\n * 函数去抖\n * @param {function} fn - 需要去抖的函数\n * @param {number} delay - 延迟时间，单位：ms\n * @return {function} 封装后的去抖函数\n */\nexport function debounce(fn, delay = 500) {\n  // 定时器\n  let timer\n\n  return function() {\n    // 保存函数调用时的上下文和参数，用于传递给 fn\n    const context = this\n    const args = arguments\n\n    // 每次这个返回的函数被调用，就清除定时器，以保证不执行 fn\n    clearTimeout(timer)\n\n    // 当返回的函数被最后一次调用后（也就是用户停止了某个连续的操作），\n    // 再过 delay 毫秒就执行 fn\n    timer = setTimeout(() => {\n      fn.apply(context, args)\n    }, delay)\n  }\n}\n\n/**\n * 函数节流\n * @param {function} fn - 需要节流的函数\n * @param {number} threshold - 执行间隔阈值，单位：ms\n * @return {function} 封装后的节流函数\n */\nexport function throttle(fn, threshold = 500) {\n  // 定时器\n  let timer\n  // 记录上次执行的时间\n  let last = +new Date()\n\n  return function() {\n    // 保存函数调用时的上下文和参数，用于传递给 fn\n    const context = this\n    const args = arguments\n    // 记录函数的调用时间\n    const now = +new Date()\n    clearTimeout(timer)\n\n    // 如果距离上次执行 fn 函数的时间小于 threshold，那么就放弃执行 fn，并重新计时\n    if (now - last < threshold) {\n      // 保证在当前时间区间结束后，再执行一次 fn\n      timer = setTimeout(() => {\n        last = now\n        fn.apply(context, args)\n      }, threshold)\n    } else {\n      // 在大于指定时间阈值后执行一次 fn\n      last = now\n      fn.apply(context, args)\n    }\n  }\n}\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Image.vue?vue&type=style&index=0&id=00d82a28&scoped=true&lang=css\""],"sourceRoot":""}